#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# æª¢æŸ¥ç‰ˆæœ¬è™Ÿä¸€è‡´æ€§
echo "ğŸ” æª¢æŸ¥ç‰ˆæœ¬è™Ÿä¸€è‡´æ€§..."

# è®€å– package.json ç‰ˆæœ¬è™Ÿ
PACKAGE_VERSION=$(node -p "require('./package.json').version")

# æª¢æŸ¥ä¸»è¦æª”æ¡ˆä¸­çš„ç‰ˆæœ¬è™Ÿ
HTML_VERSION=$(grep -o "const APP_VERSION = '[^']*'" index.html | grep -o "'[^']*'" | tr -d "'")
SW_VERSION=$(grep -o "const APP_VERSION = '[^']*'" sw.js | grep -o "'[^']*'" | tr -d "'")
MANIFEST_VERSION=$(grep -o '"version": "[^"]*"' app.webmanifest | grep -o '"[^"]*"' | tr -d '"')

# æª¢æŸ¥ç‰ˆæœ¬è™Ÿæ˜¯å¦ä¸€è‡´
if [ "$PACKAGE_VERSION" != "$HTML_VERSION" ] || [ "$PACKAGE_VERSION" != "$SW_VERSION" ] || [ "$PACKAGE_VERSION" != "$MANIFEST_VERSION" ]; then
    echo "âŒ ç‰ˆæœ¬è™Ÿä¸ä¸€è‡´ï¼"
    echo "   package.json: $PACKAGE_VERSION"
    echo "   index.html: $HTML_VERSION"
    echo "   sw.js: $SW_VERSION"
    echo "   app.webmanifest: $MANIFEST_VERSION"
    echo ""
    echo "è«‹åŸ·è¡Œ 'npm run update-version-files' ä¾†åŒæ­¥ç‰ˆæœ¬è™Ÿ"
    exit 1
fi

echo "âœ… ç‰ˆæœ¬è™Ÿæª¢æŸ¥é€šé: v$PACKAGE_VERSION"
